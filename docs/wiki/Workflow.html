<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Workflow – Guidelines</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-dfb324f25d9b1687192fa8be62ac8f9c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Guidelines</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../wiki/Intro.html"> 
<span class="menu-text">Intro</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../wiki/Workflow.html" aria-current="page"> 
<span class="menu-text">Workflow</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../wiki/Principles.html"> 
<span class="menu-text">Principles</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../Vocabulary.html"> 
<span class="menu-text">Vocabulary</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../wiki/Syntax.html"> 
<span class="menu-text">Syntax</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../wiki/Examples.html"> 
<span class="menu-text">Examples</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#preliminaries" id="toc-preliminaries" class="nav-link active" data-scroll-target="#preliminaries">Preliminaries</a>
  <ul class="collapse">
  <li><a href="#installing-tilia" id="toc-installing-tilia" class="nav-link" data-scroll-target="#installing-tilia">Installing TiLiA</a></li>
  <li><a href="#ressources-for-learning-tilia" id="toc-ressources-for-learning-tilia" class="nav-link" data-scroll-target="#ressources-for-learning-tilia">Ressources for learning TiLiA</a></li>
  <li><a href="#using-git" id="toc-using-git" class="nav-link" data-scroll-target="#using-git">Using Git</a></li>
  </ul></li>
  <li><a href="#annotating-during-the-pilot-project" id="toc-annotating-during-the-pilot-project" class="nav-link" data-scroll-target="#annotating-during-the-pilot-project">Annotating during the pilot project</a>
  <ul class="collapse">
  <li><a href="#whats-in-this-repo" id="toc-whats-in-this-repo" class="nav-link" data-scroll-target="#whats-in-this-repo">What’s in this repo?</a></li>
  <li><a href="#where-to-begin" id="toc-where-to-begin" class="nav-link" data-scroll-target="#where-to-begin">Where to begin?</a></li>
  <li><a href="#annotating" id="toc-annotating" class="nav-link" data-scroll-target="#annotating">Annotating</a></li>
  </ul></li>
  <li><a href="#for-curators" id="toc-for-curators" class="nav-link" data-scroll-target="#for-curators">For curators</a>
  <ul class="collapse">
  <li><a href="#preparing-a-new-tilia-file-for-analysis" id="toc-preparing-a-new-tilia-file-for-analysis" class="nav-link" data-scroll-target="#preparing-a-new-tilia-file-for-analysis">Preparing a new TiLiA file for analysis</a>
  <ul class="collapse">
  <li><a href="#sec-audio_score_alignment" id="toc-sec-audio_score_alignment" class="nav-link" data-scroll-target="#sec-audio_score_alignment">Aligning a score with an audio recording</a></li>
  <li><a href="#preparing-a-repo-batch-alignment" id="toc-preparing-a-repo-batch-alignment" class="nav-link" data-scroll-target="#preparing-a-repo-batch-alignment">Preparing a repo: Batch alignment</a></li>
  </ul></li>
  <li><a href="#re-align-an-existing-tilia-file" id="toc-re-align-an-existing-tilia-file" class="nav-link" data-scroll-target="#re-align-an-existing-tilia-file">Re-align an existing TiLiA file</a></li>
  <li><a href="#exporting-a-tilia-file-to-one-csv-file-per-timeline" id="toc-exporting-a-tilia-file-to-one-csv-file-per-timeline" class="nav-link" data-scroll-target="#exporting-a-tilia-file-to-one-csv-file-per-timeline">Exporting a TiLiA file to one CSV file per timeline</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Workflow</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="preliminaries" class="level1">
<h1>Preliminaries</h1>
<section id="installing-tilia" class="level2">
<h2 class="anchored" data-anchor-id="installing-tilia">Installing TiLiA</h2>
<p>As our main annotation tool, we use the TimeLineAnnotator (aka. TiLiA), a GUI for producing and displaying complex annotations with video and audio files. For each piece in the corpus, a .tla file will be provided, which includes a recording aligned with a score element (musicXML), a complete beat grid, and an empty hierarchy timeline for creating the form analysis.</p>
<p>The newest version of the TiLiA app can be downloaded <a href="https://tilia-ad98d.web.app/downloads">here</a> or <a href="https://github.com/TimeLineAnnotator/desktop?tab=readme-ov-file#build-from-source">built from source</a> using <a href="https://pyinstaller.org/en/stable/">PyInstaller</a>. Please reference the <a href="https://tilia-app.com/help/installation/">installation guide</a> to troubleshoot common installation issues, such as safety settings blocking installation.</p>
</section>
<section id="ressources-for-learning-tilia" class="level2">
<h2 class="anchored" data-anchor-id="ressources-for-learning-tilia">Ressources for learning TiLiA</h2>
<p>Basic information about how to use TiLiA and its different features can be found at:</p>
<ul>
<li><a href="https://tilia-ad98d.web.app/help">TiLiA Website</a></li>
<li><a href="https://www.youtube.com/@tilia-app">TiLiA Youtube Channel</a></li>
<li><a href="https://github.com/TimeLineAnnotator/desktop">TiLiA GitHub</a></li>
</ul>
<p>Miscellaneous Workflow Advice:</p>
<ul>
<li>Make sure that the file is saved in a non-temporary folder.</li>
<li>The saved .tla files cannot be opened by simply clicking on them. This means you always have to open the app first and then the file from the app.</li>
<li>Save your file regularly to avoid losing progress. You are advised to track changes via git to better remedy file corruption.</li>
<li>If the app crashes while you have not saved for a long time, you can check whether a file has been saved in the ‘Autosaves’ folder (File =&gt; Open Autosaves Folder =&gt; Copy path; then File =&gt; Open =&gt; Select path to Autosaves folder and open the last saved version)</li>
<li>Depending on what you find easier for the music, you may either proceed
<ul>
<li>from larger sections to smaller ones in a top-down way: move the top-level up several times, create child, then split the child using shortcut <code>s</code>, add levels to split children etc.,</li>
<li>or identify small formal units and group them upwards by selecting adjacent components (Ctrl-click or drawing a rectangle) and grouping them (shortcut: g).</li>
</ul></li>
</ul>
<p>Please refer to the <strong>Principles</strong> page for more detailed guidance on how to use the app in the context of this project.</p>
</section>
<section id="using-git" class="level2">
<h2 class="anchored" data-anchor-id="using-git">Using Git</h2>
<p>A good understanding how git works (creating branches, committing &amp; pushing changes, merge request &amp; merge) is necessary to collaborate on our decentralised annotation project. There is plenty of learning material available online (e.g.&nbsp;<a href="https://hamwaves.com/collaboration/doc/rypress.com/index.html">Ry’s Tutorial</a>) and you can use whatever you prefer. For a very brief reference of the commands you need to know, see the <a href="https://dcmlab.github.io/standards/build/html/git/git.html">Quick Git Reference</a> from the DCML corpus initiative, a predecessor of the current project on Musical Form. This reference contains a small collection of useful config options for your local git installation which can make your life easier. If you don’t know git, it may serve as a primer but does not replace a more thorough introduction to git.</p>
</section>
</section>
<section id="annotating-during-the-pilot-project" class="level1">
<h1>Annotating during the pilot project</h1>
<ul>
<li>We are not using OpenProject for workpackage management during the pilot because each annotator has a fixed-size work package predetermined.</li>
<li>We provide prepared TiLiA files for the 48 pieces in the pilot corpus. The person who is to annotate one of them will
<ul>
<li>create a new branch named after the file and your initials, e.g.&nbsp;<code>BWV1007_01_Prelude_jh</code>,</li>
<li>commit incremental changes with meaningful commit messages,</li>
<li>and create a Pull Request (PR) (including a screenshot) once the analysis is complete.</li>
</ul></li>
</ul>
<p>Before you can start, you need to <code>git clone git@github.com:MusicalForm/annotation_pilot.git</code> in order to create a local copy of our <a href="https://github.com/MusicalForm/annotation_pilot/">annotation_pilot repo</a>. Cloning the repo recursively (using the command <code>git clone --recursive git@github.com:MusicalForm/annotation_pilot.git</code>). i.e., including the submodules containing the original four corpora, is not necessary because the TiLiA files, recordings, etc. are included in the pilot repo, submodules remain untouched.</p>
<section id="whats-in-this-repo" class="level2">
<h2 class="anchored" data-anchor-id="whats-in-this-repo">What’s in this repo?</h2>
<p>You’ll find a breakdown of what’s included in the repo in its <a href="https://github.com/MusicalForm/annotation_pilot/blob/main/README.md">README</a>.</p>
</section>
<section id="where-to-begin" class="level2">
<h2 class="anchored" data-anchor-id="where-to-begin">Where to begin?</h2>
<ol type="1">
<li>Pick one of pieces assigned to you and create a new branch reflecting the corresponding file name, followed by your initials, e.g.&nbsp;<code>BWV1007_01_Prelude_jh</code> (to avoid name conflicts for doubly assigned pieces). Be sure that every new branch is created from an up-to-date main branch (in practice, you <code>git checkout main</code> and <code>git pull</code> before creating the new branch).</li>
<li>Open TiLiA and load the corresponding <code>.tla</code> file from the <code>TiLiA</code> folder. The app will attempt to find the audio file but when it fails, you will see an error message and then be prompted to select the audio file manually. Either way, once you save the file, you should see the respective file path in the <code>.tla</code> file change (the file is in JSON format).</li>
<li>You should be seeing the timelines listed under <a href="#sec-tilia_layout">TiLiA Layout</a>. The most important one is the empty hierarchy timeline called <code>Form</code>.</li>
</ol>
</section>
<section id="annotating" class="level2">
<h2 class="anchored" data-anchor-id="annotating">Annotating</h2>
<ol type="1">
<li>Create your form components and cadence markers. Save and commit every now and then.
<ul>
<li>If no key segments are available, create those as well (hierarchy timeline with a single level).</li>
<li>When you end up with two alternative views that you find equally convincing, add a new hierarchy timeline and encode the alternative for the given segment only.</li>
<li>Whenever useful, add free-text comments to your analytical elements.</li>
<li>Comments not specifically linked with a hierarchy component, e.g.&nbsp;comments on dramaturgical observations, can be added as markers.</li>
</ul></li>
<li>When problems arise, please let everyone know:
<ul>
<li>For technical issues with our workflow, <a href="https://github.com/MusicalForm/annotation_pilot/issues">please open an issue</a> in the <code>annotation_pilot</code> repo.</li>
<li>For anything related to the annotation standard, <a href="https://github.com/MusicalForm/annotation_pilot/discussions">please open a discussion</a> instead.</li>
</ul></li>
<li>When your analysis is done and all commits are pushed, create a Pull Request (PR) in the <code>annotation_pilot</code> repo. Please paste a screenshot of the analysis in the PR description in order to facilitate later discussions. Add a small summary focusing on any problems you may have encountered. In particular, be verbose about any segments where you have encoded two alternatives or where you were considering to do so.</li>
</ol>
</section>
</section>
<section id="for-curators" class="level1">
<h1>For curators</h1>
<section id="preparing-a-new-tilia-file-for-analysis" class="level2">
<h2 class="anchored" data-anchor-id="preparing-a-new-tilia-file-for-analysis">Preparing a new TiLiA file for analysis</h2>
<p>In terms of files you will need:</p>
<ul>
<li>a MusicXML file of the piece in question</li>
<li>an unfolded <code>notes</code> TSV file as output by the <code>ms3</code> parser (<code>ms3 extract -a -N -u</code>)</li>
<li>a public-domain audio recording or, in its absence, a synthesized rendition of the piece (we avoid YouTube renditions for reasons of data longevity)</li>
</ul>
<p>In terms of software you’ll need:</p>
<ul>
<li>TiLiA, obviously</li>
<li><a href="https://github.com/johentsch/ms3_realtime/">ms3_realtime</a> which includes an installation of the <code>ms3</code> parser</li>
</ul>
<section id="sec-audio_score_alignment" class="level3">
<h3 class="anchored" data-anchor-id="sec-audio_score_alignment">Aligning a score with an audio recording</h3>
<section id="generate-an-aligned-beat-grid" class="level4">
<h4 class="anchored" data-anchor-id="generate-an-aligned-beat-grid">Generate an aligned beat grid</h4>
<p>The first step is to generate a <code>&lt;filename&gt;.beatgrid.csv</code> file containing a beat grid for the score, mapped to the corresponding timecodes in the recording.</p>
<p>What you need:</p>
<ul>
<li>a working Python environment with Python 3.10 or newer (we recommend <a href="https://docs.anaconda.com/miniconda/">Miniconda</a>)</li>
<li>a MuseScore file of the piece in question</li>
<li>an audio recording, possibly one in the public domain so that it can be shared
<ul>
<li>first stop: <a href="https://imslp.org/">IMSLP</a></li>
<li><a href="https://search.creativecommons.org/">Creative Commons Search</a></li>
<li><a href="https://musopen.org/">MusOpen</a> (requires log-in)</li>
<li><a href="https://archive.org/">archive.org</a></li>
<li><a href="https://pool.musicalheritage.org">Musical Heritage Organization</a></li>
</ul></li>
</ul>
<p>Then you can:</p>
<ul>
<li>head to <a href="https://github.com/johentsch/ms3_realtime/">johentsch/ms3_realtime</a> and do the <a href="https://github.com/johentsch/ms3_realtime/#first-time-setup">first-time setup</a></li>
<li>follow the instructions under <a href="https://github.com/johentsch/ms3_realtime/#deriving-timelines-from-aligned-notes">Deriving timelines from aligned notes</a></li>
</ul>
</section>
<section id="import-the-beatgrid-into-the-tilia-file" class="level4">
<h4 class="anchored" data-anchor-id="import-the-beatgrid-into-the-tilia-file">Import the beatgrid into the TiLiA file</h4>
<p>Instructions are in the <a href="https://github.com/johentsch/ms3_realtime/?tab=readme-ov-file#create-a-tilia-file">same document over there @ ms3_realtime</a>.</p>
</section>
<section id="import-the-score" class="level4">
<h4 class="anchored" data-anchor-id="import-the-score">Import the score</h4>
<ol type="1">
<li>If the score contains annotations, you first need to remove them.</li>
</ol>
</section>
</section>
<section id="preparing-a-repo-batch-alignment" class="level3">
<h3 class="anchored" data-anchor-id="preparing-a-repo-batch-alignment">Preparing a repo: Batch alignment</h3>
<ol type="1">
<li>Download public domain recordings
<ol type="1">
<li><p>Before anything, rename them so that they can easily be matched with the scores but without removing important identifiers. E.g. for the <code>bach_solo</code> repo, the recordings combine the piece IDs with the original IMSLP filename: <code>BWV1007_01_Prelude-IMSLP717130-PMLP164349-Casals</code>.</p></li>
<li><p>If the original files are in WAV format, use that for alignment but add a conversion to MP3 to the repo. E.g.:</p>
<pre><code>for f in *.wav; do ffmpeg -i "$f" -vn -ac 2 -codec:a libmp3lame -q:a 0 "${f%.wav}.mp3"; done</code></pre></li>
</ol></li>
<li>Make sure that the unfolded notes table match the recordings. E.g., in the case of <code>bach_solo</code> suites BWV 1007 and 1008, the two minuets came in two separate scores but in a single audio file following the “minuet 1 da capo”. Although in theory it would be conceivable to split the audio recording, the obvious solution here is to create a unified score which encodes the repeat structure of the encoding and to create the unfolded notes table from that.</li>
<li>Create a batch CSV file mapping audio to notes TSV files.
<ol type="1">
<li>Create a CSV file with the columns “audio” and “notes” containing the respective file paths. Paths should use <code>/</code> separators, not <code>\</code>. Relative paths relative to the repo’s top level are advisable.</li>
<li>For controlling the output file names, an optional “name” column can be added.</li>
</ol></li>
<li>Align
<ol type="1">
<li><code>ms3_realtime</code> approach (preferred)
<ol type="1">
<li>Output CSV files for TiLiA import directly (<code>-tla</code> option).</li>
<li>Commit to the respective subfolder under <code>alignments</code>.</li>
</ol></li>
<li><code>beat_this</code> approach (requires <code>torch</code> which can take time to set up)
<ol type="1">
<li>Use <a href="https://github.com/CPJKU/beat_this/">beat_this</a> to create one <code>.beats</code> file per recording</li>
<li>Use the <code>beats2measuregrid.py</code> script to convert the files to TiLiA’s CSV format.</li>
</ol></li>
</ol></li>
<li>Create TiLiA files manually.</li>
</ol>
</section>
</section>
<section id="re-align-an-existing-tilia-file" class="level2">
<h2 class="anchored" data-anchor-id="re-align-an-existing-tilia-file">Re-align an existing TiLiA file</h2>
<p>This documents what to do in order to re-align the timelines in an existing TiLiA file with a different recording.</p>
<p><strong>Requirements</strong></p>
<ul>
<li>A recording featuring the same flow through the score as reflected in the TiLiA file.</li>
<li>A MuseScore file that unfolds correctly to that same file.</li>
<li>The TiLiA file needs to have a beat grid with the correct sequence of measure numbers.</li>
</ul>
<p>For example, a 16-bar score in which the first 8 bars are repeated goes together with</p>
<ul>
<li>a recording that plays the first 8 bars twice, followed by bars 9-16,</li>
<li>a TiLiA file with a beat grid that has measure numbers 1-8, then again 1-8, then 9-16.</li>
</ul>
<p><strong>Preliminaries</strong></p>
<p>Clone https://github.com/TimeToAlign/dashboard and, in a new virtual Python environment, execute <code>pip install -r requirements.txt</code> to install the dependencies.</p>
<p><strong>Process</strong></p>
<ol type="1">
<li><p>Export the TiLiA file to JSON (File =&gt; Export =&gt; JSON).</p></li>
<li><p>Follow the procedure <a href="#sec-audio_score_alignment">above</a> to create the <code>.beatgrid.csv</code> file which aligns the score with the new recording.</p></li>
<li><p>Activate the correct virtual environment and execute</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> processing/notebooks/tilia_warp.py path/to/tilia_export.json path/to/piece.beatgrid.csv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This will output one CSV file per timeline in the TiLiA file with adjusted timecodes.</p></li>
<li><p>Create a new TiLiA file, add the local recording file, and import the CSV files one by one.</p></li>
</ol>
</section>
<section id="exporting-a-tilia-file-to-one-csv-file-per-timeline" class="level2">
<h2 class="anchored" data-anchor-id="exporting-a-tilia-file-to-one-csv-file-per-timeline">Exporting a TiLiA file to one CSV file per timeline</h2>
<p>Simply use the re-alignment script <code>tilia_warp.py</code> passing only the exported JSON file as argument:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> processing/notebooks/tilia_warp.py path/to/tilia_export.json</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>By default, the CSV files will be exported to the same folder as the JSON file.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>